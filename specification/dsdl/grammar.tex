\section{Grammar}\label{sec:dsdl_grammar}

이 섹션은 DSDL 문법의 공식 정의를 다룬다.
표기법에 전에 소개하였다.
문법의 각 엘리멘트와 의미는 다음 섹션에서 설명한다.

\subsection{Notation}

다음 정의는 PEG\footnote{Parsing expression grammar.}
table~\ref{table:dsdl_grammar_definition_notation}%
\footnote{%
    Inspired by Parsimonious -- an MIT-licensed software product authored by Erik Rose;
    its sources are available at \url{https://github.com/erikrose/parsimonious}.
}의 표기법을 따른다.
공식 정의에 대한 내용은 넘버 기호(#)으로 시작하는 코멘트를 포함하며 해당 라인의 끝까지 계속된다.

\begin{UAVCANSimpleTable}{Notation used in the formal grammar definition}{|l X|}
    \label{table:dsdl_grammar_definition_notation}
    Pattern & Description \\

    \texttt{"text"} &
    Denotes a terminal string of ASCII characters.
    The string is case-sensitive. \\

    \emph{(space)} &
    Concatenation.
    E.g., \texttt{korovan paukan excavator} matches a sequence where the specified tokens
    appear in the defined order. \\

    \texttt{abc / ijk / xyz} &
    Alternatives.
    The leftmost matching alternative is accepted. \\

    \texttt{abc?} &
    Optional greedy match. \\

    \texttt{abc*} &
    Zero or more expressions, greedy match. \\

    \texttt{abc+} &
    One or more expressions, greedy match. \\

    \texttt{\textasciitilde{}r"regex"} &
    An IEEE POSIX Extended Regular Expression pattern defined between the double quotes.
    The expression operates on the ASCII character set and is always case-sensitive.
    ASCII escape sequences ``\texttt{\textbackslash{}r}'', ``\texttt{\textbackslash{}n}'', and
    ``\texttt{\textbackslash{}t}'' are used to denote ASCII carriage return (code 13),
    line feed (code 10), and tabulation (code 9) characters, respectively. \\

    \texttt{\textasciitilde{}r'regex'} &
    As above, with single quotes instead of double quotes. \\

    \texttt{(abc xyz)} &
    Parentheses are used for grouping. \\
\end{UAVCANSimpleTable}

\subsection{Definition}

가장 상위 레벨에서 DSDL 정의 파일은 구문의 순서를 가지는 집합이다.;
이 순서는 DSDL 소스 파일 내부에 구문의 상대 위치로 결정된다.;
파일의 시분 부분에 가까이 위치할수록 파일의 끝에 위치한 구문보다 우선 순위를 가진다.

상위 레벨로부터 표현 원칙으로 내려가서 문법은 유효한 정규 문법으로 표준 정규 표현을 사용하여 파싱할 수 있다는 의미다.

여기서 제공하는 문법 정의는 어휘 분석 없는 파싱을 의미한다.;
즉 처리되지 않은 정의 소스 텍스트에 바로 적용된다.

정의에 사용되는 모든 문자는 ASCII 문자 집합에 속한다.

\clearpage\inputminted[fontsize=\scriptsize]{python}{dsdl/grammar.parsimonious}

\subsection{Expressions}

오퍼레이터를 표현하는 기호는 ASCII(기본 라틴) 문자를 사용한다.

동일한 우선 순위 오퍼레이터들인 경우 왼쪽에서 오른쪽으로 처리한다.

속성 참조 오퍼레이터는 특수한 경우: 왼쪽에 타입의 인스턴스, 오른쪽에 속성 식별를 정의한다.
``attribute identifier'' 개념은 타입 시스템에서 선언하지 않는다.
attribute reference operator는 데이터 타입에 대해서 명시적으로 문서화하지는 않는다.;
대신에 문서에서는 언급한 타입의 인스턴에 대해서 만약 유효한 속성이 있는 경우에 그 집합을 지정한다.

\begin{UAVCANSimpleTable}{Unary operators}{|l l X|}
    Symbol                             & Precedence & Description \\
    \texttt{\textbf{+}}                         & 3 & Unary plus \\
    \texttt{\textbf{-}} (hyphen-minus)          & 3 & Unary minus \\
    \texttt{\textbf{!}}                         & 8 & Logical not \\
\end{UAVCANSimpleTable}

\begin{UAVCANSimpleTable}{Binary operators}{|l l X|}
    Symbol                                          & Precedence & Description \\
    \texttt{\textbf{.}} (full stop)                          & 1 & Attribute reference
                                                                   (parent object on the left side,
                                                                   attribute identifier on the right side) \\

    \texttt{\textbf{**}}                                     & 2 & Exponentiation
                                                                   (base on the left side, power on the right side) \\

    \texttt{\textbf{*}}                                      & 4 & Multiplication \\
    \texttt{\textbf{/}}                                      & 4 & Division \\
    \texttt{\textbf{\%}}                                     & 4 & Modulo \\

    \texttt{\textbf{+}}                                      & 5 & Addition \\
    \texttt{\textbf{-}} (hyphen-minus)                       & 5 & Subtraction \\

    \texttt{\textbf{|}} (vertical line)                      & 6 & Bitwise or \\
    \texttt{\textbf{\textasciicircum{}}} (circumflex accent) & 6 & Bitwise xor \\
    \texttt{\textbf{\&}}                                     & 6 & Bitwise and \\

    \texttt{\textbf{==}} (dual equals sign)                  & 7 & Equality \\
    \texttt{\textbf{!=}}                                     & 7 & Inequality \\
    \texttt{\textbf{<=}}                                     & 7 & Less or equal \\
    \texttt{\textbf{>=}}                                     & 7 & Greater or equal \\
    \texttt{\textbf{<}}                                      & 7 & Less \\
    \texttt{\textbf{>}}                                      & 7 & Greater \\

    \texttt{\textbf{||}} (dual vertical line)                & 9 & Logical or \\
    \texttt{\textbf{\&\&}}                                   & 9 & Logical and \\
\end{UAVCANSimpleTable}

\subsection{Literals}

evaluation에 따라서 리터널의 문법에 따라서 리터널은 특정 타입의 객체를 생성하게 되며 이번 섹션에서 다룬다.

\subsubsection{Boolean literals}

boolean literal은 ``\verb|true|'' 혹은 ``\verb|false|'' 키워드로 나타내고 primitive 타입의 ``\verb|bool|'' (section~\ref{sec:dsdl_primitive_types}) 인스턴스로 표현한다.

\subsubsection{Numeric literals}

Integer와 real literal들은 ``\verb|rational|'' (section~\ref{sec:dsdl_rational}) 타입의 인스턴스로 표현한다.

숫자 구분 문자 ``\verb|_|'' (밑줄) 은 numeric literals를 해석에 영향을 주지 않는다.

real literal의 significand는 정수 부분, decimal point와 fraction 부분으로 구성된다.;
정수 부분 혹은 fraction 부분은 생략이 가능하다.(둘다 생략은 불가)
``\verb|e|'' 혹은 ``\verb|E|'' 문자 뒤에 exponent는 옵션으로 지정할 수 있다.;
10의 거듭제곱을 표시한다.
decimal point 혹은 letter ``\verb|e|''/``\verb|E|'' 중에 하나는 real literal 에서 생략할 수 있다.

\begin{remark}
    An integer literal \verb|0x123| is represented internally as $\frac{291}{1}$.

    A real literal \verb|.3141592653589793e+1| is represented internally as
    $\frac{3141592653589793}{1000000000000000}$.
\end{remark}

\subsubsection{String literals}

문자 literal은 ``\verb|string|'' (section~\ref{sec:dsdl_string}) 타입의 인스턴스로 표현된다.

문자 literal은 유니코드 문자들의 임의의 순서로 나열되며 table~\ref{table:dsdl_string_literal_escape} 에서 정의한 내부 형태 중에 하나를 따르는 정의한 escape 순서는 제외된다.
escape 순서는 ASCII 백슬래쉬 문자 ``\verb|\|'' 로 시작한다.

\begin{UAVCANSimpleTable}{String literal escape sequences}{|l X|}
    Sequence & Interpretation
    \label{table:dsdl_string_literal_escape} \\

    \texttt{\textbackslash{}\textbackslash{}}   & Backslash, ASCII code 92. Same as the escape character. \\
    \texttt{\textbackslash{}r}                  & Carriage return, ASCII code 13.               \\
    \texttt{\textbackslash{}n}                  & Line feed, ASCII code 10.                     \\
    \texttt{\textbackslash{}t}                  & Horizontal tabulation, ASCII code 9.          \\

    \texttt{\textbackslash{}\textquotesingle{}} &
    Apostrophe (single quote), ASCII code 39. Regardless of the type of quotes around the literal. \\

    \texttt{\textbackslash{}\textquotedbl{}}    &
    Quotation mark (double quote), ASCII code 34. Regardless of the type of quotes around the literal. \\

    \texttt{\textbackslash{}u????} &
    Unicode symbol with the code point specified by a four-digit hexadecimal number.
    The placeholder ``\texttt{?}'' represents a hexadecimal character \texttt{[0-9a-fA-F]}. \\

    \texttt{\textbackslash{}U????????} &
    Like above, the code point is specified by an eight-digit hexadecimal number. \\

\end{UAVCANSimpleTable}

\begin{remark}
    \begin{minted}{python}
        @assert "oh,\u0020hi\U0000000aMark" == 'oh, hi\nMark'
    \end{minted}
\end{remark}

\subsubsection{Set literals}

Set literals는 ``\verb|set|'' (section~\ref{sec:dsdl_set}) 타입의 인스턴스로 표현하고 자동으로 결정되는 엘리먼트의 타입으로 파라미터화 된다.

set literal 선언은 적어도 하나의 엘리먼트를 지정하고 이는 해당 set의 엘리먼트 타입을 결정하는데 사용된다.

set literal의 엘리먼트들은 DSDL 표현으로 정의되고 관련 literal로부터 set이 구성되기 전에 evalution된다.

\begin{remark}
    \begin{minted}{python}
        @assert {"cells", 'interlinked'} == {"inter" + "linked", 'cells'}
    \end{minted}
\end{remark}

\subsection{Reserved identifiers}\label{sec:dsdl_reserved_identifiers}

table~\ref{table:dsdl_reserved_word_patterns}에서 지정한 대소문자를 가리는 패턴 중에 매칭되는 것이 있는 DSDL 식별자와 데이터 타입 이름 컴포넌트는 새로운 엔트티에 이름을 주는 거에 사용할 수 없다.
이런 식별자의 의미는 DSDL 스펙에서 미리 정의되고 다른 목적으로 사용할 수 없다.
예약된 식별자 중에 일부는 현재 DSDL 스펙에 관련된 function을 가지고 있지 않지만 향후에는 변경이 될 수 있다.

\begin{UAVCANSimpleTable}{Reserved identifier patterns (POSIX ERE notation, ASCII character set, case-insensitive)}%
    {|l l X|}%
    \label{table:dsdl_reserved_word_patterns}%
    POSIX ERE ASCII pattern                            & Example            & Special meaning \\
    \texttt{truncated}                                 &                    & Cast mode specifier \\
    \texttt{saturated}                                 &                    & Cast mode specifier \\
    \texttt{true}                                      &                    & Boolean literal \\
    \texttt{false}                                     &                    & Boolean literal \\
    \texttt{bool}                                      &                    & Primitive type category \\
    \texttt{u?int\textbackslash{}d*}                   & \texttt{uint8}     & Primitive type category \\
    \texttt{float\textbackslash{}d*}                   & \texttt{float}     & Primitive type category \\
    \texttt{u?q\textbackslash{}d+\_\textbackslash{}d+} & \texttt{q16\_8}    & Primitive type category (future) \\
    \texttt{void\textbackslash{}d*}                    & \texttt{void}      & Void type category \\
    \texttt{optional}                                  &                    & Reserved for future use \\
    \texttt{aligned}                                   &                    & Reserved for future use \\
    \texttt{const}                                     &                    & Reserved for future use \\
    \texttt{struct}                                    &                    & Reserved for future use \\
    \texttt{super}                                     &                    & Reserved for future use \\
    \texttt{template}                                  &                    & Reserved for future use \\
    \texttt{enum}                                      &                    & Reserved for future use \\
    \texttt{self}                                      &                    & Reserved for future use \\
    \texttt{and}                                       &                    & Reserved for future use \\
    \texttt{or}                                        &                    & Reserved for future use \\
    \texttt{not}                                       &                    & Reserved for future use \\
    \texttt{auto}                                      &                    & Reserved for future use \\
    \texttt{type}                                      &                    & Reserved for future use \\
    \texttt{con}                                       &                    & Compatibility with Microsoft Windows \\
    \texttt{prn}                                       &                    & Compatibility with Microsoft Windows \\
    \texttt{aux}                                       &                    & Compatibility with Microsoft Windows \\
    \texttt{nul}                                       &                    & Compatibility with Microsoft Windows \\
    \texttt{com\textbackslash{}d}                      & \texttt{com1}      & Compatibility with Microsoft Windows \\
    \texttt{lpt\textbackslash{}d}                      & \texttt{lpt9}      & Compatibility with Microsoft Windows \\
    \texttt{\_.*\_}                                    & \texttt{\_offset\_}& Special-purpose intrinsic entities \\
\end{UAVCANSimpleTable}
